<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book List</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Book List</h1>
    <div id="books-container">
        <!-- Books will be displayed here -->
    </div>

    <script>
        const SERVER = 'http://127.0.0.1:5000';

        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            console.log('Token stored:', token)

            if (!token) {
                alert('No access token found, please log in.');
                window.location.href = '/login'; // Redirect to login if no token found
                return;
            }

            axios.get(SERVER + '/display_books', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => {
                const books = response.data;
                console.log(books);
                const booksContainer = document.getElementById('books-container');
                booksContainer.innerHTML = '';

                books.forEach(book => {
                    const bookElement = document.createElement('div');
                    bookElement.innerHTML = `
                        <h2>${book.name}</h2>
                        <p>Author: ${book.author}</p>
                        <p>Year Published: ${book.year_published}</p>
                        <p>Borrow Time: ${book.borrow_time}</p>
                        <p>Status: ${book.status}</p>
                        <img src="/media/${book.filename}" alt="${book.name}" style="width: 100px; height: 100px;">
                    `;
                    booksContainer.appendChild(bookElement);
                });
            })
            .catch(error => {
                console.error('Error fetching books:', error);
                alert('Failed to fetch books.');
            });
        });
    </script>
</body>
</html>
